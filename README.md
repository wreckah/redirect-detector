## Разрешение цепочек редиректов

Программа принимает на вход URL и возвращает последний адрес из цепочки редиректов, который не является редиректом. Программа поддерживает:
  - множественные редиректы;
  - определяет зацикленные редиректы и возвращает ошибку;
  - определяет редиректы с бесконечным или достаточно большим телом ответа.

Последние два условия позволяют избежать атак на HTTP-клиент, который будет загружать проверяемые документы. Зацикленные редиректы могут "вечно" занимать процесс клиента. Редиректы с бесконечным телом ответа могу также остановить работу HTTP-клиента и привести к утечкам памяти и огромному расходу трафика.

Определение редиректов осуществляется отправкой HTTP `GET` запроса вместо `HEAD`, потому что некоторые проприетарные HTTP-серверы могут не поддерживать `HEAD`. Тело ответа для редиректов не читается вообще, для остальных ответов читается с ограничением, чтобы понять, что ответ имеет разумный для скачивания размер.

Тестовый сервер был реализован в отдельном треде и подмешан к тестовому классу в виде миксина. Сервер поднимается единожды на тестовый класс и переиспользуется в тестах класса с роутингом обслуживаемых урлов, заданных в виде декоратора на каждом тесте. Это позволяет снизить расходы на запуск треда и ускорить выполнение тестов.

Запуск сервера в отдельном процессе значительно замедлил бы выполнение тестов и усложнил бы конфигурацию урлов. Плюс потенциально мог бы приводить при краше родительского процесса тестов к размножению процессов с серверами.

Кажется, что библиотека `requests` -- не самый лучший и современный инструмент для решения подобной задачи. Она не поддерживает HTTP/2, на который перешли большинство современных сайтов и неблокирующий ввод/вывод, который позволяет лучше утилизировать процессор при массовой обработке урлов. Кроме того, архитектура `requests` устроена так, что происходит попытка чтения полного тела ответа редиректа даже при `allow_redirects=False` и `stream=True`. Чтобы избежать этого нежелательного поведения, пришлось делать "манки-патчинг" кода библиотеки.

На задание я потратил 4 часа времени, хотя рассчитывал уложиться в 2. Возможно, сказалось долгое отсутствие практики.

Установка зависимостей:
```
pip3 install -r requirements.txt
```

Использование:
```
LOG_LEVEL=DEBUG python3 -m redirect_detector http://google.com
```

Запуск тестов:
```
python3 -m unittest
```
